#include <SPI.h>
#include <SD.h>
int recibir;
File myFile;
File myFile1;
File myFile2;
File creacion;
const int filas = 11;
const int columnas = 21;
char dibujo[11][21];
void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  SPI.setModule(0);
  Serial.print("Initializing SD card...");
  if (!SD.begin(32)) {
    Serial.println("initialization failed!");
    return;
  }
  Serial.println("initialization done.");

  Serial.println("Escoja una opcion");
  Serial.println("Archivo 1: Ingrese 1");
  Serial.println("Archivo 2: Ingrese 2");
  Serial.println("Archivo 3: Ingrese 3");
  Serial.println("Cree un dibujo: Ingrese 4");
}

void loop() {
  if (Serial.available()>0){
    recibir = Serial.parseInt();
    if (recibir == 1){
      myFile = SD.open("perro.txt");
      if (myFile){
        Serial.println("perro.txt");
        while (myFile.available()){
          Serial.write(myFile.read());
        }
        myFile.close();
      }
      else{
        Serial.println("error al abrir el archivo");
      }
    }
    else if (recibir == 2){
      myFile1 = SD.open("sol.txt");
      if (myFile1){
        Serial.println("sol.txt");
        while (myFile1.available()){
          Serial.write(myFile1.read());
        }
        myFile1.close();
      }
      else{
        Serial.println("error al abrir el archivo");
      }
    }
    else if (recibir == 3){
      myFile2 = SD.open("arbol.txt");
      if (myFile2){
        Serial.println("arbol.txt");
        while (myFile2.available()){
          Serial.write(myFile2.read());
        }
        myFile2.close();
      }
      else{
        Serial.println("error al abrir el archivo");
      }
    }
    else if (recibir == 4){
      Serial.println("Dibuja utilizando 'Y' y ' ' para dejar espacio y 'T' para terminar ");
      Serial.println("Tienes espacio de 20 columnas y 10 filas");
      dibujar();
      guardar();
    }
    else{
      Serial.println("Vuelva a intentar");
    }
    Serial.println("Archivo 1: Ingrese 1");
    Serial.println("Archivo 2: Ingrese 2");
    Serial.println("Archivo 3: Ingrese 3");
    Serial.println("Cree un dibujo: Ingrese 4");
    Serial.println();
  }
}
void dibujar(){
  for (int i = 0; i < filas; i++){
    for (int j = 0; j < columnas; j++){
      while (Serial.available() == 0){
      }
      char letra = Serial.read();
      if (letra == 'Y' || letra == 'y'){
        dibujo[i][j] = 'Y';
      } 
      else if (letra == 'T' || letra == 't'){
        Serial.println("Dibujo terminado");
        return;
      }
    }
  }
}
void guardar(){
  creacion = SD.open("post.txt", FILE_WRITE);
  if (creacion){
    for (int i = 0; i < filas; i++){
      for (int j = 0; j < columnas; j++){
        creacion.print(dibujo[i][j]);
      }
      creacion.println();
    }
    creacion.close();
    Serial.println("Imagen guardada, revisar micro SD");
  }
  else{
    Serial.println("Error al abrir el archivo");
  }
}